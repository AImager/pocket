<!DOCTYPE html> <html style><!--
 Page saved with SingleFile 
 url: http://xstarcd.github.io/wiki/shell/expect.html 
 saved date: Thu Feb 03 2022 06:20:41 GMT+0800 (China Standard Time)
--><meta charset=utf-8>
<style>html{color:#cad3d6;min-height:100%;background:-webkit-gradient(linear,0 100,0 98%,from(#163346),to(#000309));background-color:#123;padding:0;margin:0}body{max-width:1200px;position:relative;margin:40px auto 15px;font:100 14px/1.5 "Trebuchet MS",Helvetica,SimSun,sans-serif}ul,li{padding:0}a{color:#0df;text-decoration:none;padding-bottom:1px}a:hover{color:#5ef;padding-bottom:0;border-bottom:1px solid #468}a:visited{color:#6ac}input:focus,a:focus,button:focus{box-shadow:0 0 3px #cb0;-webkit-box-shadow:0 0 3px #cb0;-moz-box-shadow:0 0 3px #cb0}h1,h2,h3{font-family:"Microsoft Yahei",sans-serif;margin:0;padding:0.15em 0}h1{font-size:1.7em;padding-bottom:0.1em;color:#f37;margin-bottom:0.5em;margin-top:0}h2{font-size:1.52em;color:#fd5;margin-top:1em}h3{font-size:1.22em;color:#df5;width:80%;margin-top:0.9em;margin-bottom:0.4em}pre,ul{margin:0.5em 0 1em}pre{white-space:pre-wrap;word-wrap:break-word}ul ul{margin-top:0.5em;margin-bottom:0.5em}li{margin:0.3em auto;list-style-position:inside}ul{margin-left:1em;padding-left:0.5em}code{padding:2px 4px;color:#cae3b6;font-family:'Lucida Console','Courier New',Courier,monospace}pre{background:rgba(255,30,120,0.12);border:1px solid #614;position:relative;z-index:2;font-family:'Lucida Console','Courier New',Courier,monospace;-webkit-transition:all 0.45s linear;-moz-transition:all 0.45s linear}blockquote:hover,pre:hover{color:#eee;background:rgba(255,30,120,0.25)}pre{border-left:1px solid #c26;margin-left:1em;padding:0.4em 0.8em}table{border-collapse:collapse}.syntaxhighlighter td.gutter{width:1em}.syntaxhighlighter .gutter .line{padding-right:0.3em}.tocWrap{position:fixed;width:250px;z-index:100;top:5px;right:10px}.tocWrap .toggler{text-align:center;font-size:12px;background:#F0C81E;border-radius:2px 2px 0 0;-moz-border-radius:2px 2px 0 0;color:#122;position:relative;z-index:101;cursor:pointer}#main{padding:10px 20px;position:relative}#header{border-top:1px dashed #246}#top-nav{position:relative;top:-25px;width:280px;margin:0 auto;overflow:hidden;zoom:1}#top-nav li{float:left;list-style:none;margin-right:10px}#top-nav a{display:block;padding:6px 20px;background:#022538;background-color:rgba(8,32,50,0.85);background:-webkit-gradient(linear,0 0,0 90%,from(rgba(12,46,65,0.7)),to(rgba(0,35,54,0.9)));border:1px solid rgba(255,255,255,0.2);border-radius:1px;-moz-border-radius:1px;color:#abc;text-shadow:0 1px 0 #000;box-shadow:0 1px 3px rgba(10,10,0,0.6);-webkit-box-shadow:0 1px 3px rgba(10,10,0,0.6);-moz-box-shadow:0 1px 3px rgba(10,10,0,0.6);-webkit-transition:all 0.45s linear;-moz-transition:all 0.45s linear}#top-nav a:hover,#top-nav a:focus{color:#f3f3f3;border-color:rgba(255,255,255,0.35);background:-webkit-gradient(linear,0 0,0 95%,from(rgba(20,56,76,0.8)),to(rgba(0,40,60,1)));box-shadow:0 1px 0px rgba(10,10,0,0.6);-webkit-box-shadow:0 1px 0px rgba(10,10,0,0.6);-moz-box-shadow:0 1px 0px rgba(10,10,0,0.6)}#footer{margin-top:20px;text-align:center;border:5px solid rgba(255,0,80,0.42);border-width:5px 10px}#footer p{background:rgba(255,0,80,0.15);padding:1em;margin:0}#footer a{color:#967}#footer a:hover{border-bottom:1px solid #967}#cse{position:absolute;top:10px;right:10px;width:98%}</style>
<title>expect - 自动交互脚本</title>
<link type=image/x-icon rel="shortcut icon" href="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><style>.sf-hidden{display:none!important}</style><link rel=canonical href=http://xstarcd.github.io/wiki/shell/expect.html><meta http-equiv=content-security-policy content="default-src 'none'; font-src 'self' data:; img-src 'self' data:; style-src 'unsafe-inline'; media-src 'self' data:; script-src 'unsafe-inline' data:;"></head>
<body>
<div id=header>
 <ul id=top-nav>
 <li><a href=http://xstarcd.github.io/wiki/index.html>首页</a></li>
 <li><a href=http://xstarcd.github.io/wiki/shell/index.html>分类首页</a></li>
 </ul>
</div>
<div id=cse></div>
<div id=main>
<h1>expect - 自动交互脚本</h1>
<div class=tocWrap style=opacity:0.25;display:block><div class=toggler title="点击展开/收起，Shift+Z 隐藏或打开；双击放大/缩小">目录</div><div class="toc sf-hidden">
</div></div>
<h2 id=toc_0.1>expect参数</h2>
<ul>
<li>
<a href=http://xstarcd.github.io/wiki/shell/expect_handbook.html>expect教程中文版</a>
<li>
<a href=http://blog.csdn.net/classwang/article/details/3928467 target=_blank title=http://blog.csdn.net/classwang/article/details/3928467>expect中文手册</a>
<li>
<a href=http://xstarcd.github.io/wiki/shell/expect_description.html>expect说明</a>
</ul>
<h3 id=toc_0.1.1>启用选项</h3>
<ul>
<li>
<code>-c</code>:执行脚本前先执行的命令，可多次使用。
<li>
<code>-d</code>:debug模式，可以在运行时输出一些诊断信息，与在脚本开始处使用<code>exp_internal 1</code>相似。
<li>
<code>-D</code>:启用交换调式器,可设一整数参数。
<li>
<code>-f</code>:从文件读取命令，仅用于使用#!时。如果文件名为"-"，则从stdin读取(使用"./-"从文件名为-的文件读取)。
<li>
<code>-i</code>:交互式输入命令，使用"exit"或"EOF"退出输入状态。
<li>
<code>--</code>:标示选项结束(如果你需要传递与expect选项相似的参数给脚本时)，可放到<code>#!</code>行:<code>#!/usr/bin/expect --</code>。
<li>
<code>-v</code>:显示expect版本信息。
</ul>
<h3 id=toc_0.1.2>常用命令</h3>
<div><div id=highlighter_710787 class="syntaxhighlighter bash"><table border=0 cellpadding=0 cellspacing=0><tbody><tr><td class=gutter><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><td class=code><div class=container><div class="line number1 index0 alt2"><code class="bash comments"># 命令行参数 </code></div><div class="line number2 index1 alt1"><code class="bash comments"># $argv，参数数组，使用[lindex $argv n]获取，$argv 0为脚本名字</code></div><div class="line number3 index2 alt2"><code class="bash comments"># $argc，参数个数</code></div><div class="line number4 index3 alt1"><code class="bash functions">set</code> <code class="bash plain">username [lindex $argv 1]&nbsp; </code><code class="bash comments"># 获取第1个参数</code></div><div class="line number5 index4 alt2"><code class="bash functions">set</code> <code class="bash functions">passwd</code> <code class="bash plain">[lindex $argv 2]&nbsp;&nbsp;&nbsp; </code><code class="bash comments"># 获取第2个参数</code></div><div class="line number6 index5 alt1">&nbsp;</div><div class="line number7 index6 alt2"><code class="bash functions">set</code> <code class="bash plain">timeout 30 </code><code class="bash comments"># 设置超时</code></div><div class="line number8 index7 alt1">&nbsp;</div><div class="line number9 index8 alt2"><code class="bash comments"># spawn是expect内部命令，开启ssh连接</code></div><div class="line number10 index9 alt1"><code class="bash plain">spawn </code><code class="bash functions">ssh</code> <code class="bash plain">-l username 192.168.1.1</code></div><div class="line number11 index10 alt2">&nbsp;</div><div class="line number12 index11 alt1"><code class="bash comments"># 判断上次输出结果里是否包含“password:”的字符串，如果有则立即返回，否则就等待一段时间(timeout)后返回</code></div><div class="line number13 index12 alt2"><code class="bash plain">expect </code><code class="bash string">"password:"</code></div><div class="line number14 index13 alt1">&nbsp;</div><div class="line number15 index14 alt2"><code class="bash comments"># 发送内容ispass(密码、命令等)</code></div><div class="line number16 index15 alt1"><code class="bash plain">send </code><code class="bash string">"ispass\r"</code></div><div class="line number17 index16 alt2">&nbsp;</div><div class="line number18 index17 alt1"><code class="bash comments"># 发送内容给用户</code></div><div class="line number19 index18 alt2"><code class="bash plain">send_user </code><code class="bash string">"$argv0 [lrange $argv 0 2]\n"</code></div><div class="line number20 index19 alt1"><code class="bash plain">send_user </code><code class="bash string">"It's OK\r"</code></div><div class="line number21 index20 alt2"><code class="bash comments"># 执行完成后保持交互状态，控制权交给控制台(手工操作)。否则会完成后会退出。</code></div><div class="line number22 index21 alt1"><code class="bash plain">interact</code></div></div></table></div></div>
<h3 id=toc_0.1.3>命令介绍</h3>
<ul>
<li>
close:关闭当前进程的连接。
<li>
debug:控制调试器。
<li>
disconnect:断开进程连接(进程仍在后台运行)。
<ul>
<li>
定时读取密码、执行priv_prog
<div><div id=highlighter_809818 class="syntaxhighlighter bash"><table border=0 cellpadding=0 cellspacing=0><tbody><tr><td class=gutter><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><td class=code><div class=container><div class="line number1 index0 alt2"><code class="bash plain">send_user </code><code class="bash string">"password?\ "</code></div><div class="line number2 index1 alt1"><code class="bash plain">expect_user -re </code><code class="bash string">"(.*)\n"</code></div><div class="line number3 index2 alt2"><code class="bash keyword">for</code> <code class="bash plain">{} 1 {} {</code></div><div class="line number4 index3 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash keyword">if</code> <code class="bash plain">{[fork]!=0} {</code><code class="bash functions">sleep</code> <code class="bash plain">3600;</code><code class="bash keyword">continue</code><code class="bash plain">}</code></div><div class="line number5 index4 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">disconnect</code></div><div class="line number6 index5 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">spawn priv_prog</code></div><div class="line number7 index6 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">expect Password:</code></div><div class="line number8 index7 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">send </code><code class="bash string">"$expect_out(1,string)\r"</code></div><div class="line number9 index8 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">. . .</code></div><div class="line number10 index9 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">exit</code></div><div class="line number11 index10 alt2"><code class="bash plain">}</code></div></div></table></div></div>
</ul>
<li>
exit:退出expect。
<li>
exp_continue [-continue_timer]:继续执行下面的匹配。
<li>
exp_internal [-f file] value:
</ul>
<h2 id=toc_0.2>expect范例</h2>
<ul>
<li>
自动telnet会话
<div><div id=highlighter_224243 class="syntaxhighlighter bash"><table border=0 cellpadding=0 cellspacing=0><tbody><tr><td class=gutter><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><td class=code><div class=container><div class="line number1 index0 alt2"><code class="bash preprocessor bold">#!/usr/bin/expect -f</code></div><div class="line number2 index1 alt1"><code class="bash functions">set</code> <code class="bash plain">ip [lindex $argv 0 ]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="bash comments"># 接收第1个参数,作为IP</code></div><div class="line number3 index2 alt2"><code class="bash functions">set</code> <code class="bash plain">userid [lindex $argv 1 ]&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="bash comments"># 接收第2个参数,作为userid</code></div><div class="line number4 index3 alt1"><code class="bash functions">set</code> <code class="bash plain">mypassword [lindex $argv 2 ] </code><code class="bash comments"># 接收第3个参数,作为密码</code></div><div class="line number5 index4 alt2"><code class="bash functions">set</code> <code class="bash plain">mycommand [lindex $argv 3 ]&nbsp; </code><code class="bash comments"># 接收第4个参数，作为命令</code></div><div class="line number6 index5 alt1"><code class="bash functions">set</code> <code class="bash plain">timeout 10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="bash comments"># 设置超时时间</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="bash comments"># 向远程服务器请求打开一个telnet会话，并等待服务器询问用户名</code></div><div class="line number9 index8 alt2"><code class="bash plain">spawn telnet $ip</code></div><div class="line number10 index9 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">expect </code><code class="bash string">"username:"</code></div><div class="line number11 index10 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash comments"># 输入用户名，并等待服务器询问密码</code></div><div class="line number12 index11 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">send </code><code class="bash string">"$userid\r"</code></div><div class="line number13 index12 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">expect </code><code class="bash string">"password:"</code></div><div class="line number14 index13 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash comments"># 输入密码，并等待键入需要运行的命令</code></div><div class="line number15 index14 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">send </code><code class="bash string">"$mypassword\r"</code></div><div class="line number16 index15 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">expect </code><code class="bash string">"%"</code></div><div class="line number17 index16 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash comments"># 输入预先定好的密码，等待运行结果</code></div><div class="line number18 index17 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">send </code><code class="bash string">"$mycommand\r"</code></div><div class="line number19 index18 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">expect </code><code class="bash string">"%"</code></div><div class="line number20 index19 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash comments"># 将运行结果存入到变量中，显示出来或者写到磁盘中</code></div><div class="line number21 index20 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">set</code> <code class="bash plain">results $expect_out(buffer)</code></div><div class="line number22 index21 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash comments"># 退出telnet会话，等待服务器的退出提示EOF</code></div><div class="line number23 index22 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">send </code><code class="bash string">"exit\r"</code></div><div class="line number24 index23 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">expect eof</code></div></div></table></div></div>
<li>
自动建立FTP会话
<div><div id=highlighter_960000 class="syntaxhighlighter bash"><table border=0 cellpadding=0 cellspacing=0><tbody><tr><td class=gutter><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><td class=code><div class=container><div class="line number1 index0 alt2"><code class="bash preprocessor bold">#!/usr/bin/expect -f</code></div><div class="line number2 index1 alt1"><code class="bash functions">set</code> <code class="bash plain">ip [lindex $argv 0 ]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="bash comments"># 接收第1个参数,作为IP</code></div><div class="line number3 index2 alt2"><code class="bash functions">set</code> <code class="bash plain">userid [lindex $argv 1 ]&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="bash comments"># 接收第2个参数,作为Userid</code></div><div class="line number4 index3 alt1"><code class="bash functions">set</code> <code class="bash plain">mypassword [lindex $argv 2 ] </code><code class="bash comments"># 接收第3个参数,作为密码</code></div><div class="line number5 index4 alt2"><code class="bash functions">set</code> <code class="bash plain">timeout 10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="bash comments"># 设置超时时间</code></div><div class="line number6 index5 alt1">&nbsp;</div><div class="line number7 index6 alt2"><code class="bash comments"># 向远程服务器请求打开一个FTP会话，并等待服务器询问用户名</code></div><div class="line number8 index7 alt1"><code class="bash plain">spawn </code><code class="bash functions">ftp</code> <code class="bash plain">$ip</code></div><div class="line number9 index8 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">expect </code><code class="bash string">"username:"</code></div><div class="line number10 index9 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash comments"># 输入用户名，并等待服务器询问密码</code></div><div class="line number11 index10 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">send </code><code class="bash string">"$userid\r"</code></div><div class="line number12 index11 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">expect </code><code class="bash string">"password:"</code></div><div class="line number13 index12 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash comments"># 输入密码，并等待FTP提示符的出现</code></div><div class="line number14 index13 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">send </code><code class="bash string">"$mypassword\r"</code></div><div class="line number15 index14 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">expect </code><code class="bash string">"ftp&gt;"</code></div><div class="line number16 index15 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash comments"># 切换到二进制模式，并等待FTP提示符的出现</code></div><div class="line number17 index16 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">send </code><code class="bash string">"bin\r"</code></div><div class="line number18 index17 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">expect </code><code class="bash string">"ftp&gt;"</code></div><div class="line number19 index18 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash comments"># 关闭ftp的提示符</code></div><div class="line number20 index19 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">send </code><code class="bash string">"prompt\r"</code></div><div class="line number21 index20 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">expect </code><code class="bash string">"ftp&gt;"</code></div><div class="line number22 index21 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash comments"># 下载所有文件</code></div><div class="line number23 index22 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">send </code><code class="bash string">"mget *\r"</code></div><div class="line number24 index23 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">expect </code><code class="bash string">"ftp&gt;"</code></div><div class="line number25 index24 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash comments"># 退出此次ftp会话，并等待服务器的退出提示EOF</code></div><div class="line number26 index25 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">send </code><code class="bash string">"bye\r"</code></div><div class="line number27 index26 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">expect eof</code></div></div></table></div></div>
</ul>
<ul>
<li>
自动登录ssh执行命令
<div><div id=highlighter_300036 class="syntaxhighlighter bash"><table border=0 cellpadding=0 cellspacing=0><tbody><tr><td class=gutter><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><td class=code><div class=container><div class="line number1 index0 alt2"><code class="bash preprocessor bold">#!/usr/bin/expect</code></div><div class="line number2 index1 alt1"><code class="bash functions">set</code> <code class="bash plain">IP&nbsp;&nbsp;&nbsp;&nbsp; [lindex $argv 0]</code></div><div class="line number3 index2 alt2"><code class="bash functions">set</code> <code class="bash plain">USER&nbsp;&nbsp; [lindex $argv 1]</code></div><div class="line number4 index3 alt1"><code class="bash functions">set</code> <code class="bash plain">PASSWD [lindex $argv 2]</code></div><div class="line number5 index4 alt2"><code class="bash functions">set</code> <code class="bash plain">CMD&nbsp;&nbsp;&nbsp; [lindex $argv 3]</code></div><div class="line number6 index5 alt1">&nbsp;</div><div class="line number7 index6 alt2"><code class="bash plain">spawn </code><code class="bash functions">ssh</code> <code class="bash plain">$USER@$IP $CMD</code></div><div class="line number8 index7 alt1"><code class="bash plain">expect {</code></div><div class="line number9 index8 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash string">"(yes/no)?"</code> <code class="bash plain">{</code></div><div class="line number10 index9 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">send </code><code class="bash string">"yes\r"</code></div><div class="line number11 index10 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">expect </code><code class="bash string">"password:"</code></div><div class="line number12 index11 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">send </code><code class="bash string">"$PASSWD\r"</code></div><div class="line number13 index12 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">}</code></div><div class="line number14 index13 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash string">"password:"</code> <code class="bash plain">{send </code><code class="bash string">"$PASSWD\r"</code><code class="bash plain">}</code></div><div class="line number15 index14 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash string">"* to host"</code> <code class="bash plain">{</code><code class="bash functions">exit</code> <code class="bash plain">1}</code></div><div class="line number16 index15 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">}</code></div><div class="line number17 index16 alt2"><code class="bash plain">expect eof</code></div></div></table></div></div>
<li>
自动登录ssh
<div><div id=highlighter_42461 class="syntaxhighlighter bash"><table border=0 cellpadding=0 cellspacing=0><tbody><tr><td class=gutter><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><td class=code><div class=container><div class="line number1 index0 alt2"><code class="bash preprocessor bold">#!/usr/bin/expect -f&nbsp; </code></div><div class="line number2 index1 alt1"><code class="bash functions">set</code> <code class="bash plain">ip [lindex $argv 0 ]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="bash comments"># 接收第1个参数,作为IP</code></div><div class="line number3 index2 alt2"><code class="bash functions">set</code> <code class="bash plain">username [lindex $argv 1 ]&nbsp;&nbsp; </code><code class="bash comments"># 接收第2个参数,作为username</code></div><div class="line number4 index3 alt1"><code class="bash functions">set</code> <code class="bash plain">mypassword [lindex $argv 2 ] </code><code class="bash comments"># 接收第3个参数,作为密码</code></div><div class="line number5 index4 alt2"><code class="bash functions">set</code> <code class="bash plain">timeout 10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="bash comments"># 设置超时时间 </code></div><div class="line number6 index5 alt1">&nbsp;</div><div class="line number7 index6 alt2"><code class="bash plain">spawn </code><code class="bash functions">ssh</code> <code class="bash plain">$username@$ip&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="bash comments"># 发送ssh请求</code></div><div class="line number8 index7 alt1"><code class="bash plain">expect {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="bash comments"># 返回信息匹配 </code></div><div class="line number9 index8 alt2"><code class="bash string">"*yes/no"</code> <code class="bash plain">{ send </code><code class="bash string">"yes\r"</code><code class="bash plain">; exp_continue}&nbsp; </code><code class="bash comments"># 第一次ssh连接会提示yes/no,继续&nbsp; </code></div><div class="line number10 index9 alt1"><code class="bash string">"*password:"</code> <code class="bash plain">{ send </code><code class="bash string">"$mypassword\r"</code> <code class="bash plain">}&nbsp;&nbsp;&nbsp; </code><code class="bash comments"># 出现密码提示,发送密码&nbsp; </code></div><div class="line number11 index10 alt2"><code class="bash plain">} </code></div><div class="line number12 index11 alt1"><code class="bash plain">interact&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="bash comments"># 交互模式,用户会停留在远程服务器上面</code></div></div></table></div></div>
</ul>
<ul>
<li>
批量登录ssh服务器执行操作范例，设定增量的for循环
<div><div id=highlighter_657009 class="syntaxhighlighter bash"><table border=0 cellpadding=0 cellspacing=0><tbody><tr><td class=gutter><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><td class=code><div class=container><div class="line number1 index0 alt2"><code class="bash preprocessor bold">#!/usr/bin/expect</code></div><div class="line number2 index1 alt1"><code class="bash keyword">for</code> <code class="bash plain">{</code><code class="bash functions">set</code> <code class="bash plain">i 10} {$i &lt;= 12} {incr i} {</code></div><div class="line number3 index2 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">set</code> <code class="bash plain">timeout 30</code></div><div class="line number4 index3 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">set</code> <code class="bash plain">ssh_user [lindex $argv 0]</code></div><div class="line number5 index4 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">spawn </code><code class="bash functions">ssh</code> <code class="bash plain">-i .</code><code class="bash functions">ssh</code><code class="bash plain">/$ssh_user abc$i.com</code></div><div class="line number6 index5 alt1">&nbsp;</div><div class="line number7 index6 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">expect_before </code><code class="bash string">"no)?"</code> <code class="bash plain">{</code></div><div class="line number8 index7 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">send </code><code class="bash string">"yes\r"</code> <code class="bash plain">}</code></div><div class="line number9 index8 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">sleep</code> <code class="bash plain">1</code></div><div class="line number10 index9 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">expect </code><code class="bash string">"password*"</code></div><div class="line number11 index10 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">send </code><code class="bash string">"hello\r"</code></div><div class="line number12 index11 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">expect </code><code class="bash string">"*#"</code></div><div class="line number13 index12 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">send </code><code class="bash string">"echo hello expect! &gt; /tmp/expect.txt\r"</code></div><div class="line number14 index13 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">expect </code><code class="bash string">"*#"</code></div><div class="line number15 index14 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">send </code><code class="bash string">"echo\r"</code></div><div class="line number16 index15 alt1"><code class="bash plain">}</code></div><div class="line number17 index16 alt2"><code class="bash functions">exit</code></div></div></table></div></div>
</ul>
<ul>
<li>
批量登录ssh并执行命令，foreach语法
<div><div id=highlighter_629598 class="syntaxhighlighter bash"><table border=0 cellpadding=0 cellspacing=0><tbody><tr><td class=gutter><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><td class=code><div class=container><div class="line number1 index0 alt2"><code class="bash preprocessor bold">#!/usr/bin/expect</code></div><div class="line number2 index1 alt1"><code class="bash keyword">if</code> <code class="bash plain">{$argc!=2} {</code></div><div class="line number3 index2 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">send_user </code><code class="bash string">"usage: ./expect ssh_user password\n"</code></div><div class="line number4 index3 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">exit</code></div><div class="line number5 index4 alt2"><code class="bash plain">}</code></div><div class="line number6 index5 alt1"><code class="bash plain">foreach i {11 12} {</code></div><div class="line number7 index6 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">set</code> <code class="bash plain">timeout 30</code></div><div class="line number8 index7 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">set</code> <code class="bash plain">ssh_user [lindex $argv 0]</code></div><div class="line number9 index8 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">set</code> <code class="bash plain">password [lindex $argv 1]</code></div><div class="line number10 index9 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">spawn </code><code class="bash functions">ssh</code> <code class="bash plain">-i .</code><code class="bash functions">ssh</code><code class="bash plain">/$ssh_user root@xxx.yy.com</code></div><div class="line number11 index10 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">expect_before </code><code class="bash string">"no)?"</code> <code class="bash plain">{</code></div><div class="line number12 index11 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">send </code><code class="bash string">"yes\r"</code> <code class="bash plain">}</code></div><div class="line number13 index12 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">sleep</code> <code class="bash plain">1</code></div><div class="line number14 index13 alt1">&nbsp;</div><div class="line number15 index14 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">expect </code><code class="bash string">"Enter passphrase for key*"</code></div><div class="line number16 index15 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">send </code><code class="bash string">"password\r"</code></div><div class="line number17 index16 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">expect </code><code class="bash string">"*#"</code></div><div class="line number18 index17 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">send </code><code class="bash string">"echo hello expect! &gt; /tmp/expect.txt\r"</code></div><div class="line number19 index18 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">expect </code><code class="bash string">"*#"</code></div><div class="line number20 index19 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">send </code><code class="bash string">"echo\r"</code></div><div class="line number21 index20 alt2"><code class="bash plain">}</code></div><div class="line number22 index21 alt1"><code class="bash functions">exit</code></div></div></table></div></div>
</ul>
<ul>
<li>
另一自动ssh范例，从命令行获取服务器IP，foreach语法，expect嵌套
<div><div id=highlighter_777506 class="syntaxhighlighter bash"><table border=0 cellpadding=0 cellspacing=0><tbody><tr><td class=gutter><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><td class=code><div class=container><div class="line number1 index0 alt2"><code class="bash preprocessor bold">#!/usr/bin/expect</code></div><div class="line number2 index1 alt1"><code class="bash comments"># 使用方法: script_name ip1 ip2 ip3 ...</code></div><div class="line number3 index2 alt2">&nbsp;</div><div class="line number4 index3 alt1"><code class="bash functions">set</code> <code class="bash plain">timeout 20</code></div><div class="line number5 index4 alt2"><code class="bash keyword">if</code> <code class="bash plain">{$argc &lt; 1} {</code></div><div class="line number6 index5 alt1"><code class="bash spaces">&nbsp;&nbsp;</code><code class="bash plain">puts </code><code class="bash string">"Usage: script IPs"</code></div><div class="line number7 index6 alt2"><code class="bash spaces">&nbsp;&nbsp;</code><code class="bash functions">exit</code> <code class="bash plain">1</code></div><div class="line number8 index7 alt1"><code class="bash plain">}</code></div><div class="line number9 index8 alt2"><code class="bash comments"># 替换你自己的用户名</code></div><div class="line number10 index9 alt1"><code class="bash functions">set</code> <code class="bash plain">user </code><code class="bash string">"username"</code></div><div class="line number11 index10 alt2"><code class="bash comments">#替换你自己的登录密码</code></div><div class="line number12 index11 alt1"><code class="bash functions">set</code> <code class="bash plain">password </code><code class="bash string">"yourpassword"</code></div><div class="line number13 index12 alt2">&nbsp;</div><div class="line number14 index13 alt1"><code class="bash plain">foreach IP $argv {</code></div><div class="line number15 index14 alt2"><code class="bash plain">spawn </code><code class="bash functions">ssh</code> <code class="bash plain">$user@$IP</code></div><div class="line number16 index15 alt1">&nbsp;</div><div class="line number17 index16 alt2"><code class="bash plain">expect \</code></div><div class="line number18 index17 alt1"><code class="bash spaces">&nbsp;&nbsp;</code><code class="bash string">"(yes/no)?"</code> <code class="bash plain">{</code></div><div class="line number19 index18 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">send </code><code class="bash string">"yes\r"</code></div><div class="line number20 index19 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">expect </code><code class="bash string">"password:?"</code> <code class="bash plain">{</code></div><div class="line number21 index20 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">send </code><code class="bash string">"$password\r"</code></div><div class="line number22 index21 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">}</code></div><div class="line number23 index22 alt2"><code class="bash spaces">&nbsp;&nbsp;</code><code class="bash plain">} </code><code class="bash string">"password:?"</code> <code class="bash plain">{</code></div><div class="line number24 index23 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">send </code><code class="bash string">"$password\r"</code></div><div class="line number25 index24 alt2"><code class="bash plain">}</code></div><div class="line number26 index25 alt1">&nbsp;</div><div class="line number27 index26 alt2"><code class="bash plain">expect </code><code class="bash string">"\$?"</code></div><div class="line number28 index27 alt1"><code class="bash comments"># 替换你要执行的命令</code></div><div class="line number29 index28 alt2"><code class="bash plain">send </code><code class="bash string">"last\r"</code></div><div class="line number30 index29 alt1"><code class="bash plain">expect </code><code class="bash string">"\$?"</code></div><div class="line number31 index30 alt2"><code class="bash functions">sleep</code> <code class="bash plain">10</code></div><div class="line number32 index31 alt1"><code class="bash plain">send </code><code class="bash string">"exit\r"</code></div><div class="line number33 index32 alt2"><code class="bash plain">expect eof</code></div><div class="line number34 index33 alt1"><code class="bash plain">}</code></div></div></table></div></div>
</ul>
<ul>
<li>
批量ssh执行命令，用shell调用tclsh方式、多进程同时执行
<ul>
<li>
tclsh - Simple shell containing Tcl interpreter
<div><div id=highlighter_570873 class="syntaxhighlighter bash"><table border=0 cellpadding=0 cellspacing=0><tbody><tr><td class=gutter><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><td class=code><div class=container><div class="line number1 index0 alt2"><code class="bash preprocessor bold">#!/bin/sh</code></div><div class="line number2 index1 alt1"><code class="bash comments"># -*- tcl -*- \</code></div><div class="line number3 index2 alt2"><code class="bash functions">exec</code> <code class="bash plain">tclsh $0 </code><code class="bash string">"$@"</code></div><div class="line number4 index3 alt1"><code class="bash plain">package require Expect</code></div><div class="line number5 index4 alt2"><code class="bash functions">set</code> <code class="bash plain">username [lindex $argv 0]</code></div><div class="line number6 index5 alt1"><code class="bash functions">set</code> <code class="bash plain">password [lindex $argv 1]</code></div><div class="line number7 index6 alt2"><code class="bash functions">set</code> <code class="bash plain">argv [lrange $argv 2 end]</code></div><div class="line number8 index7 alt1"><code class="bash functions">set</code> <code class="bash plain">prompt </code><code class="bash string">"(%|#|\\$) $"</code></div><div class="line number9 index8 alt2"><code class="bash plain">foreach ip $argv {</code></div><div class="line number10 index9 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">spawn </code><code class="bash functions">ssh</code> <code class="bash plain">-t $username@$ip sh</code></div><div class="line number11 index10 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">lappend ids $spawn_id</code></div><div class="line number12 index11 alt1"><code class="bash plain">}</code></div><div class="line number13 index12 alt2"><code class="bash plain">expect_before -i ids eof {</code></div><div class="line number14 index13 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">set</code> <code class="bash plain">index [lsearch $ids $expect_out(spawn_id)]</code></div><div class="line number15 index14 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">set</code> <code class="bash plain">ids [lreplace $ids $index $index]</code></div><div class="line number16 index15 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash keyword">if</code> <code class="bash plain">[llength $ids] exp_continue</code></div><div class="line number17 index16 alt2"><code class="bash plain">}</code></div><div class="line number18 index17 alt1"><code class="bash plain">expect -i ids </code><code class="bash string">"(yes/no)\\?"</code> <code class="bash plain">{</code></div><div class="line number19 index18 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">send -i $expect_out(spawn_id) </code><code class="bash functions">yes</code><code class="bash plain">\r</code></div><div class="line number20 index19 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">exp_continue</code></div><div class="line number21 index20 alt2"><code class="bash plain">} -i ids </code><code class="bash string">"Enter passphrase for key"</code> <code class="bash plain">{</code></div><div class="line number22 index21 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">send -i $expect_out(spawn_id) \r</code></div><div class="line number23 index22 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">exp_continue</code></div><div class="line number24 index23 alt1"><code class="bash plain">} -i ids </code><code class="bash string">"assword:"</code> <code class="bash plain">{</code></div><div class="line number25 index24 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">send -i $expect_out(spawn_id) $password\r</code></div><div class="line number26 index25 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">exp_continue</code></div><div class="line number27 index26 alt2"><code class="bash plain">} -i ids -re $prompt {</code></div><div class="line number28 index27 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">set</code> <code class="bash plain">spawn_id $expect_out(spawn_id)</code></div><div class="line number29 index28 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">send </code><code class="bash string">"echo hello; exit\r"</code></div><div class="line number30 index29 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">exp_continue</code></div><div class="line number31 index30 alt2"><code class="bash plain">} timeout {</code></div><div class="line number32 index31 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">exit</code> <code class="bash plain">1</code></div><div class="line number33 index32 alt2"><code class="bash plain">}</code></div></div></table></div></div>
</ul>
</ul>
<ul>
<li>
ssh登录过程常规提示文字
<pre>The authenticity of host '192.168.17.35 (192.168.17.35)' can't be established.
RSA key fingerprint is 25:e8:4c:89:a3:b2:06:ee:de:66:c7:7e:1b:fa:1c:c5.
Are you sure you want to continue connecting (yes/no)?


Warning: Permanently added '192.168.17.35' (RSA) to the list of known hosts.
Enter passphrase for key '/data/key/my_dsa':


Last login: Sun Jan 26 13:39:37 2014 from 192.168.11.143
[root@master003 ~]#


root@192.168.16.90's password:


Last login: Thu Jan 23 17:50:43 2014 from 192.168.11.102
[root@lvsmaster ~]#
</pre>
</ul>
<ul>
<li>
ssh自动登录expect脚本:ssh.expect
<div><div id=highlighter_778738 class="syntaxhighlighter bash"><table border=0 cellpadding=0 cellspacing=0><tbody><tr><td class=gutter><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1">44</div><td class=code><div class=container><div class="line number1 index0 alt2"><code class="bash preprocessor bold">#!/usr/bin/expect -f</code></div><div class="line number2 index1 alt1"><code class="bash comments"># Auther:YuanXing</code></div><div class="line number3 index2 alt2"><code class="bash comments"># Update:2014-02-08</code></div><div class="line number4 index3 alt1"><code class="bash keyword">if</code> <code class="bash plain">{$argc &lt; 4} {</code></div><div class="line number5 index4 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">send_user </code><code class="bash string">"Usage:\n&nbsp; $argv0 IPaddr User Passwd Port Passphrase\n"</code></div><div class="line number6 index5 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">puts stderr </code><code class="bash string">"argv error!\n"</code></div><div class="line number7 index6 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">sleep</code> <code class="bash plain">1</code></div><div class="line number8 index7 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">exit</code> <code class="bash plain">1</code></div><div class="line number9 index8 alt2"><code class="bash plain">}</code></div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2"><code class="bash functions">set</code> <code class="bash plain">ip&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [lindex $argv 0 ]</code></div><div class="line number12 index11 alt1"><code class="bash functions">set</code> <code class="bash plain">user&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [lindex $argv 1 ]</code></div><div class="line number13 index12 alt2"><code class="bash functions">set</code> <code class="bash functions">passwd</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="bash plain">[lindex $argv 2 ]</code></div><div class="line number14 index13 alt1"><code class="bash functions">set</code> <code class="bash plain">port&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [lindex $argv 3 ]</code></div><div class="line number15 index14 alt2"><code class="bash functions">set</code> <code class="bash plain">passphrase [lindex $argv 4 ]</code></div><div class="line number16 index15 alt1"><code class="bash functions">set</code> <code class="bash plain">timeout 6</code></div><div class="line number17 index16 alt2"><code class="bash keyword">if</code> <code class="bash plain">{$port == </code><code class="bash string">""</code><code class="bash plain">} {</code></div><div class="line number18 index17 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">set</code> <code class="bash plain">port 22</code></div><div class="line number19 index18 alt2"><code class="bash plain">}</code></div><div class="line number20 index19 alt1"><code class="bash comments">#send_user "IP:$ip,User:$user,Passwd:$passwd,Port:$port,Passphrase:$passphrase"</code></div><div class="line number21 index20 alt2"><code class="bash plain">spawn </code><code class="bash functions">ssh</code> <code class="bash plain">-p $port $user@$ip</code></div><div class="line number22 index21 alt1">&nbsp;</div><div class="line number23 index22 alt2"><code class="bash plain">expect_before </code><code class="bash string">"(yes/no)\\?"</code> <code class="bash plain">{</code></div><div class="line number24 index23 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">send </code><code class="bash string">"yes\r"</code><code class="bash plain">}</code></div><div class="line number25 index24 alt2">&nbsp;</div><div class="line number26 index25 alt1"><code class="bash plain">expect \</code></div><div class="line number27 index26 alt2"><code class="bash string">"Enter passphrase for key*"</code> <code class="bash plain">{</code></div><div class="line number28 index27 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">send </code><code class="bash string">"$passphrase\r"</code></div><div class="line number29 index28 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">exp_continue</code></div><div class="line number30 index29 alt1"><code class="bash plain">} </code><code class="bash string">" password:?"</code> <code class="bash plain">{</code></div><div class="line number31 index30 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">send </code><code class="bash string">"$passwd\r"</code></div><div class="line number32 index31 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">exp_continue</code></div><div class="line number33 index32 alt2"><code class="bash plain">} </code><code class="bash string">"*\[#\\\$]"</code> <code class="bash plain">{</code></div><div class="line number34 index33 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">interact</code></div><div class="line number35 index34 alt2"><code class="bash plain">} </code><code class="bash string">"* to host"</code> <code class="bash plain">{</code></div><div class="line number36 index35 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">send_user </code><code class="bash string">"Connect faild!"</code></div><div class="line number37 index36 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">exit</code> <code class="bash plain">2</code></div><div class="line number38 index37 alt1"><code class="bash plain">} timeout {</code></div><div class="line number39 index38 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">send_user </code><code class="bash string">"Connect timeout!"</code></div><div class="line number40 index39 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">exit</code> <code class="bash plain">2</code></div><div class="line number41 index40 alt2"><code class="bash plain">} eof {</code></div><div class="line number42 index41 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">send_user </code><code class="bash string">"Lost connect!"</code></div><div class="line number43 index42 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">exit</code></div><div class="line number44 index43 alt1"><code class="bash plain">}</code></div></div></table></div></div>
<li>
Mikrotik backup script using ssh and expect
<ul>
<li>
<a href=http://www.pmoghadam.com/homepage/HTML/mikrotik-backup-script-ssh-expect.html target=_blank title=http://www.pmoghadam.com/homepage/HTML/mikrotik-backup-script-ssh-expect.html>http://www.pmoghadam.com/homepage/HTML/mikrotik-backup-script-ssh-expect.html</a>
<div><div id=highlighter_768229 class="syntaxhighlighter bash"><table border=0 cellpadding=0 cellspacing=0><tbody><tr><td class=gutter><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1">44</div><div class="line number45 index44 alt2">45</div><div class="line number46 index45 alt1">46</div><div class="line number47 index46 alt2">47</div><div class="line number48 index47 alt1">48</div><div class="line number49 index48 alt2">49</div><div class="line number50 index49 alt1">50</div><td class=code><div class=container><div class="line number1 index0 alt2"><code class="bash preprocessor bold">#!/bin/bash</code></div><div class="line number2 index1 alt1"><code class="bash comments"># BY: Pejman Moghadam</code></div><div class="line number3 index2 alt2"><code class="bash comments"># TAG: mikrotik, ssh, expect, lftp</code></div><div class="line number4 index3 alt1"><code class="bash comments"># DATE: 2012-05-27 14:42:14 </code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="bash plain">BACKUP_DIR=</code><code class="bash string">"/var/backups"</code></div><div class="line number7 index6 alt2"><code class="bash plain">HOSTNAME=</code><code class="bash string">"192.168.88.1"</code></div><div class="line number8 index7 alt1"><code class="bash plain">PORT=</code><code class="bash string">"22"</code></div><div class="line number9 index8 alt2"><code class="bash plain">USER=</code><code class="bash string">"admin"</code></div><div class="line number10 index9 alt1"><code class="bash plain">PASS=</code><code class="bash string">"123456"</code></div><div class="line number11 index10 alt2"><code class="bash plain">TMP=$(mktemp)</code></div><div class="line number12 index11 alt1"><code class="bash plain">TODAY=$(</code><code class="bash functions">date</code> <code class="bash plain">+%F)</code></div><div class="line number13 index12 alt2"><code class="bash plain">FILENAME=</code><code class="bash string">"$HOSTNAME-$TODAY"</code></div><div class="line number14 index13 alt1"><code class="bash plain">PATH=</code><code class="bash string">"/usr/local/sbin:/usr/sbin:/sbin:/usr/local/bin:/usr/bin:/bin"</code></div><div class="line number15 index14 alt2">&nbsp;</div><div class="line number16 index15 alt1"><code class="bash comments"># create expect script</code></div><div class="line number17 index16 alt2"><code class="bash functions">cat</code> <code class="bash plain">&gt; $TMP &lt;&lt; EOF </code></div><div class="line number18 index17 alt1"><code class="bash comments">#exp_internal 1 # Uncomment for debug</code></div><div class="line number19 index18 alt2"><code class="bash functions">set</code> <code class="bash plain">timeout -1</code></div><div class="line number20 index19 alt1"><code class="bash plain">spawn </code><code class="bash functions">ssh</code> <code class="bash plain">-p$PORT $USER@$HOSTNAME</code></div><div class="line number21 index20 alt2"><code class="bash plain">match_max 100000</code></div><div class="line number22 index21 alt1"><code class="bash plain">expect -exact </code><code class="bash string">"password:"</code></div><div class="line number23 index22 alt2"><code class="bash plain">send -- </code><code class="bash string">"$PASS\r"</code></div><div class="line number24 index23 alt1"><code class="bash functions">sleep</code> <code class="bash plain">1</code></div><div class="line number25 index24 alt2"><code class="bash plain">expect </code><code class="bash string">" &gt; "</code></div><div class="line number26 index25 alt1"><code class="bash plain">send -- </code><code class="bash string">"/export file=$FILENAME\r"</code></div><div class="line number27 index26 alt2"><code class="bash plain">expect </code><code class="bash string">" &gt; "</code></div><div class="line number28 index27 alt1"><code class="bash plain">send -- </code><code class="bash string">"/system backup save name=$FILENAME\r"</code></div><div class="line number29 index28 alt2"><code class="bash plain">expect </code><code class="bash string">" &gt; "</code></div><div class="line number30 index29 alt1"><code class="bash plain">send -- </code><code class="bash string">"quit\r"</code></div><div class="line number31 index30 alt2"><code class="bash plain">expect eof</code></div><div class="line number32 index31 alt1"><code class="bash plain">EOF</code></div><div class="line number33 index32 alt2">&nbsp;</div><div class="line number34 index33 alt1"><code class="bash comments"># run expect script</code></div><div class="line number35 index34 alt2"><code class="bash comments">#cat $TMP # Uncomment for debug</code></div><div class="line number36 index35 alt1"><code class="bash plain">expect -f $TMP</code></div><div class="line number37 index36 alt2">&nbsp;</div><div class="line number38 index37 alt1"><code class="bash comments"># remove expect script</code></div><div class="line number39 index38 alt2"><code class="bash functions">rm</code> <code class="bash plain">$TMP</code></div><div class="line number40 index39 alt1">&nbsp;</div><div class="line number41 index40 alt2"><code class="bash comments"># download and remove backup files</code></div><div class="line number42 index41 alt1"><code class="bash comments"># "xfer:clobber on" means overwrite existing files</code></div><div class="line number43 index42 alt2"><code class="bash functions">cd</code> <code class="bash plain">${BACKUP_DIR}</code></div><div class="line number44 index43 alt1"><code class="bash functions">echo</code> <code class="bash plain">"</code></div><div class="line number45 index44 alt2"><code class="bash spaces">&nbsp;&nbsp;</code><code class="bash functions">set</code> <code class="bash plain">xfer:clobber on</code></div><div class="line number46 index45 alt1"><code class="bash spaces">&nbsp;&nbsp;</code><code class="bash plain">get ${FILENAME}.rsc</code></div><div class="line number47 index46 alt2"><code class="bash spaces">&nbsp;&nbsp;</code><code class="bash functions">rm</code> <code class="bash plain">${FILENAME}.rsc </code></div><div class="line number48 index47 alt1"><code class="bash spaces">&nbsp;&nbsp;</code><code class="bash plain">get ${FILENAME}.backup</code></div><div class="line number49 index48 alt2"><code class="bash spaces">&nbsp;&nbsp;</code><code class="bash functions">rm</code> <code class="bash plain">${FILENAME}.backup" | </code></div><div class="line number50 index49 alt1"><code class="bash plain">lftp -u $USER,$PASS $HOSTNAME</code></div></div></table></div></div>
</ul>
</ul>
</div>
<div id=footer>
<p>
© 2012 - 2015 XStar
&nbsp;|&nbsp;<a href=http://code.google.com/p/vimwiki/ title=http://code.google.com/p/vimwiki/ target=_blank>Powerby:Vimwiki</a>
&nbsp;|&nbsp;<a href=http://kwiki.github.io/ title=http://kwiki.github.io/ target=_blank>Style:丘迟</a>
&nbsp;|&nbsp;<a href=http://xstarcd.github.io/wiki/index.html>首页</a>
&nbsp;|&nbsp;<a href=http://xstarcd.github.io/wiki/shell/index.html>分类首页</a>
&nbsp;|&nbsp;<a href=http://xstarcd.github.io/wiki/SiteMap.html>站点地图</a>
</p>
</div>
<style>.syntaxhighlighter div,.syntaxhighlighter code,.syntaxhighlighter table,.syntaxhighlighter table td,.syntaxhighlighter table tr,.syntaxhighlighter table tbody{-moz-border-radius:0 0 0 0!important;-webkit-border-radius:0 0 0 0!important;background:none!important;border:0!important;bottom:auto!important;float:none!important;height:auto!important;left:auto!important;line-height:1.1em!important;margin:0!important;outline:0!important;overflow:visible!important;padding:0!important;position:static!important;right:auto!important;text-align:left!important;top:auto!important;vertical-align:baseline!important;width:auto!important;box-sizing:content-box!important;font-family:"Consolas","Bitstream Vera Sans Mono","Courier New",Courier,monospace!important;font-weight:normal!important;font-style:normal!important;font-size:1em!important;min-height:inherit!important;min-height:auto!important}.syntaxhighlighter{width:100%!important;margin:1em 0 1em 0!important;position:relative!important;overflow:auto!important;font-size:1em!important}.syntaxhighlighter .bold{font-weight:bold!important}.syntaxhighlighter .line{white-space:pre!important}.syntaxhighlighter table{width:100%!important}.syntaxhighlighter table td.code{width:100%!important}.syntaxhighlighter table td.code .container{position:relative!important}.syntaxhighlighter table td.gutter .line{text-align:right!important;padding:0 0.5em 0 1em!important}.syntaxhighlighter table td.code .line{padding:0 1em!important}</style><style>.syntaxhighlighter div,.syntaxhighlighter code,.syntaxhighlighter table,.syntaxhighlighter table td,.syntaxhighlighter table tr,.syntaxhighlighter table tbody{-moz-border-radius:0 0 0 0!important;-webkit-border-radius:0 0 0 0!important;background:none!important;border:0!important;bottom:auto!important;float:none!important;height:auto!important;left:auto!important;line-height:1.1em!important;margin:0!important;outline:0!important;overflow:visible!important;padding:0!important;position:static!important;right:auto!important;text-align:left!important;top:auto!important;vertical-align:baseline!important;width:auto!important;box-sizing:content-box!important;font-family:"Consolas","Bitstream Vera Sans Mono","Courier New",Courier,monospace!important;font-weight:normal!important;font-style:normal!important;font-size:1em!important;min-height:inherit!important;min-height:auto!important}.syntaxhighlighter{width:100%!important;margin:1em 0 1em 0!important;position:relative!important;overflow:auto!important;font-size:1em!important}.syntaxhighlighter .bold{font-weight:bold!important}.syntaxhighlighter .line{white-space:pre!important}.syntaxhighlighter table{width:100%!important}.syntaxhighlighter table td.code{width:100%!important}.syntaxhighlighter table td.code .container{position:relative!important}.syntaxhighlighter table td.gutter .line{text-align:right!important;padding:0 0.5em 0 1em!important}.syntaxhighlighter table td.code .line{padding:0 1em!important}.syntaxhighlighter{background-color:#0f192a!important}.syntaxhighlighter .line.alt1{background-color:#0f192a!important}.syntaxhighlighter .line.alt2{background-color:#0f192a!important}.syntaxhighlighter .gutter{color:#afafaf!important}.syntaxhighlighter .gutter .line{border-right:3px solid #435a5f!important}.syntaxhighlighter .plain{color:#d1edff!important}.syntaxhighlighter .comments{color:#428bdd!important}.syntaxhighlighter .string{color:#1dc116!important}.syntaxhighlighter .keyword{color:#b43d3d!important}.syntaxhighlighter .preprocessor{color:#8aa6c1!important}.syntaxhighlighter .functions{color:#ffaa3e!important}</style>